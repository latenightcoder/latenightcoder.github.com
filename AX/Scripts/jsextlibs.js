window.Modernizr=function(n,t,i){function w(n){c.cssText=n}function ct(n,t){return w(b.join(n+";")+(t||""))}function s(n,t){return typeof n===t}function tt(n,t){return!!~(""+n).indexOf(t)}function rt(n,t){var u,r;for(u in n)if(r=n[u],!tt(r,"-")&&c[r]!==i)return t=="pfx"?r:!0;return!1}function vt(n,t,r){var f,u;for(f in n)if(u=t[n[f]],u!==i)return r===!1?n[f]:s(u,"function")?u.bind(r||t):u;return!1}function h(n,t,i){var r=n.charAt(0).toUpperCase()+n.slice(1),u=(n+" "+et.join(r+" ")+r).split(" ");return s(t,"string")||s(t,"undefined")?rt(u,t):(u=(n+" "+st.join(r+" ")+r).split(" "),vt(u,t,i))}function yt(){r.input=function(i){for(var r=0,u=i.length;r<u;r++)p[i[r]]=i[r]in f;return p.list&&(p.list=!!t.createElement("datalist")&&!!n.HTMLDataListElement),p}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),r.inputtypes=function(n){for(var o=0,r,u,s,h=n.length;o<h;o++)f.setAttribute("type",u=n[o]),r=f.type!=="text",r&&(f.value=it,f.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(u)&&f.style.WebkitAppearance!==i?(e.appendChild(f),s=t.defaultView,r=s.getComputedStyle&&s.getComputedStyle(f,null).WebkitAppearance!=="textfield"&&f.offsetHeight!==0,e.removeChild(f)):/^(search|tel)$/.test(u)||(r=/^(url|email)$/.test(u)?f.checkValidity&&f.checkValidity()===!1:f.value!=it)),ht[n[o]]=!!r;return ht}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var at="2.6.2",r={},nt=!0,e=t.documentElement,o="modernizr",ut=t.createElement(o),c=ut.style,f=t.createElement("input"),it=":)",pt={}.toString,b=" -webkit- -moz- -o- -ms- ".split(" "),ot="Webkit Moz O ms",et=ot.split(" "),st=ot.toLowerCase().split(" "),u={},ht={},p={},k=[],g=k.slice,y,l=function(n,i,r,u){var v,l,c,a,f=t.createElement("div"),h=t.body,s=h||t.createElement("body");if(parseInt(r,10))while(r--)c=t.createElement("div"),c.id=u?u[r]:o+(r+1),f.appendChild(c);return v=["&#173;",'<style id="s',o,'">',n,"</style>"].join(""),f.id=o,(h?f:s).innerHTML+=v,s.appendChild(f),h||(s.style.background="",s.style.overflow="hidden",a=e.style.overflow,e.style.overflow="hidden",e.appendChild(s)),l=i(f,n),h?f.parentNode.removeChild(f):(s.parentNode.removeChild(s),e.style.overflow=a),!!l},lt=function(t){var r=n.matchMedia||n.msMatchMedia,i;return r?r(t).matches:(l("@media "+t+" { #"+o+" { position: absolute; } }",function(t){i=(n.getComputedStyle?getComputedStyle(t,null):t.currentStyle).position=="absolute"}),i)},ft=function(){function r(r,u){u=u||t.createElement(n[r]||"div"),r="on"+r;var f=r in u;return f||(u.setAttribute||(u=t.createElement("div")),u.setAttribute&&u.removeAttribute&&(u.setAttribute(r,""),f=s(u[r],"function"),s(u[r],"undefined")||(u[r]=i),u.removeAttribute(r))),u=null,f}var n={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return r}(),d={}.hasOwnProperty,a,v;a=!s(d,"undefined")&&!s(d.call,"undefined")?function(n,t){return d.call(n,t)}:function(n,t){return t in n&&s(n.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(n){var t=this,r,i;if(typeof t!="function")throw new TypeError;return r=g.call(arguments,1),i=function(){var f,e,u;return this instanceof i?(f=function(){},f.prototype=t.prototype,e=new f,u=t.apply(e,r.concat(g.call(arguments))),Object(u)===u?u:e):t.apply(n,r.concat(g.call(arguments)))},i}),u.flexbox=function(){return h("flexWrap")},u.touch=function(){var i;return"ontouchstart"in n||n.DocumentTouch&&t instanceof DocumentTouch?i=!0:l(["@media (",b.join("touch-enabled),("),o,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(n){i=n.offsetTop===9}),i},u.hashchange=function(){return ft("hashchange",n)&&(t.documentMode===i||t.documentMode>7)},u.history=function(){return!!n.history&&!!history.pushState},u.draganddrop=function(){var n=t.createElement("div");return"draggable"in n||"ondragstart"in n&&"ondrop"in n},u.rgba=function(){return w("background-color:rgba(150,255,150,.5)"),tt(c.backgroundColor,"rgba")},u.boxshadow=function(){return h("boxShadow")},u.opacity=function(){return ct("opacity:.55"),/^0.55$/.test(c.opacity)},u.cssanimations=function(){return h("animationName")},u.csscolumns=function(){return h("columnCount")},u.cssgradients=function(){var n="background-image:",i="gradient(linear,left top,right bottom,from(#9f9),to(white));",t="linear-gradient(left top,#9f9, white);";return w((n+"-webkit- ".split(" ").join(i+n)+b.join(t+n)).slice(0,-n.length)),tt(c.backgroundImage,"gradient")},u.cssreflections=function(){return h("boxReflect")},u.csstransitions=function(){return h("transition")},u.fontface=function(){var n;return l('@font-face {font-family:"font";src:url("https://")}',function(i,r){var e=t.getElementById("smodernizr"),u=e.sheet||e.styleSheet,f=u?u.cssRules&&u.cssRules[0]?u.cssRules[0].cssText:u.cssText||"":"";n=/src/i.test(f)&&f.indexOf(r.split(" ")[0])===0}),n},u.generatedcontent=function(){var n;return l(["#",o,"{font:0/0 a}#",o,':after{content:"',it,'";visibility:hidden;font:3px/1 a}'].join(""),function(t){n=t.offsetHeight>=3}),n};for(v in u)a(u,v)&&(y=v.toLowerCase(),r[y]=u[v](),k.push((r[y]?"":"no-")+y));return r.input||yt(),r.addTest=function(n,t){if(typeof n=="object")for(var u in n)a(n,u)&&r.addTest(u,n[u]);else{if(n=n.toLowerCase(),r[n]!==i)return r;t=typeof t=="function"?t():t,typeof nt!="undefined"&&nt&&(e.className+=" "+(t?"":"no-")+n),r[n]=t}return r},w(""),ut=f=null,r._version=at,r._prefixes=b,r._domPrefixes=st,r._cssomPrefixes=et,r.mq=lt,r.hasEvent=ft,r.testProp=function(n){return rt([n])},r.testAllProps=h,r.testStyles=l,e.className=e.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(nt?" js "+k.join(" "):""),r}(this,this.document),function(n,t){function l(n,t){var r=n.createElement("p"),i=n.getElementsByTagName("head")[0]||n.documentElement;return r.innerHTML="x<style>"+t+"</style>",i.insertBefore(r.lastChild,i.firstChild)}function e(){var n=i.elements;return typeof n=="string"?n.split(" "):n}function f(n){var t=p[n[a]];return t||(t={},s++,n[a]=s,p[s]=t),t}function c(n,i,u){if(i||(i=t),r)return i.createElement(n);u||(u=f(i));var e;return e=u.cache[n]?u.cache[n].cloneNode():it.test(n)?(u.cache[n]=u.createElem(n)).cloneNode():u.createElem(n),e.canHaveChildren&&!tt.test(n)?u.frag.appendChild(e):e}function g(n,i){if(n||(n=t),r)return n.createDocumentFragment();i=i||f(n);for(var s=i.frag.cloneNode(),u=0,o=e(),h=o.length;u<h;u++)s.createElement(o[u]);return s}function nt(n,t){t.cache||(t.cache={},t.createElem=n.createElement,t.createFrag=n.createDocumentFragment,t.frag=t.createFrag()),n.createElement=function(r){return i.shivMethods?c(r,n,t):t.createElem(r)},n.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+e().join().replace(/\w+/g,function(n){return t.createElem(n),t.frag.createElement(n),'c("'+n+'")'})+");return n}")(i,t.frag)}function v(n){n||(n=t);var u=f(n);return i.shivCSS&&!h&&!u.hasCSS&&(u.hasCSS=!!l(n,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),r||nt(n,u),n}function k(n){for(var t,u=n.getElementsByTagName("*"),r=u.length,f=RegExp("^(?:"+e().join("|")+")$","i"),i=[];r--;)t=u[r],f.test(t.nodeName)&&i.push(t.applyElement(d(t)));return i}function d(n){for(var t,r=n.attributes,f=r.length,i=n.ownerDocument.createElement(u+":"+n.nodeName);f--;)t=r[f],t.specified&&i.setAttribute(t.nodeName,t.nodeValue);return i.style.cssText=n.style.cssText,i}function rt(n){for(var t,i=n.split("{"),r=i.length,o=RegExp("(^|[\\s,>+~])("+e().join("|")+")(?=[[\\s,>+~#.:]|$)","gi"),f="$1"+u+"\\:$2";r--;)t=i[r]=i[r].split("}"),t[t.length-1]=t[t.length-1].replace(o,f),i[r]=t.join("}");return i.join("{")}function ut(n){for(var t=n.length;t--;)n[t].removeNode()}function y(n){function o(){clearTimeout(i._removeSheetTimer),t&&t.removeNode(!0),t=null}var t,s,i=f(n),e=n.namespaces,r=n.parentWindow;return!b||n.printShived?n:(typeof e[u]=="undefined"&&e.add(u),r.attachEvent("onbeforeprint",function(){o();for(var f,e,r,c=n.styleSheets,u=[],i=c.length,h=Array(i);i--;)h[i]=c[i];while(r=h.pop())if(!r.disabled&&w.test(r.media)){try{f=r.imports,e=f.length}catch(a){e=0}for(i=0;i<e;i++)h.push(f[i]);try{u.push(r.cssText)}catch(a){}}u=rt(u.reverse().join("")),s=k(n),t=l(n,u)}),r.attachEvent("onafterprint",function(){ut(s),clearTimeout(i._removeSheetTimer),i._removeSheetTimer=setTimeout(o,500)}),n.printShived=!0,n)}var o=n.html5||{},tt=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,it=/^<|^(?:a|b|button|code|div|fieldset|form|h1|h2|h3|h4|h5|h6|i|iframe|img|input|label|li|link|ol|option|p|param|q|script|select|span|strong|style|table|tbody|td|textarea|tfoot|th|thead|tr|ul)$/i,h,a="_html5shiv",s=0,p={},r,i;(function(){try{var n=t.createElement("a");n.innerHTML="<xyz></xyz>",h="hidden"in n,r=n.childNodes.length==1||function(){t.createElement("a");var n=t.createDocumentFragment();return typeof n.cloneNode=="undefined"||typeof n.createDocumentFragment=="undefined"||typeof n.createElement=="undefined"}()}catch(i){h=!0,r=!0}})(),i={elements:o.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:o.shivCSS!==!1,supportsUnknownElements:r,shivMethods:o.shivMethods!==!1,type:"default",shivDocument:v,createElement:c,createDocumentFragment:g},n.html5=i,v(t);var w=/^$|\b(?:all|print)\b/,u="html5shiv",b=!r&&function(){var i=t.documentElement;return typeof t.namespaces!="undefined"&&typeof t.parentWindow!="undefined"&&typeof i.applyElement!="undefined"&&typeof i.removeNode!="undefined"&&typeof n.attachEvent!="undefined"}();i.type+=" print",i.shivPrint=y,y(t)}(this,document),function(n,t,i){function c(n){return"[object Function]"==p.call(n)}function v(n){return"string"==typeof n}function h(){}function k(n){return!n||"loaded"==n||"complete"==n||"uninitialized"==n}function f(){var n=a.shift();l=1,n?n.t?s(function(){("c"==n.t?r.injectCss:r.injectJs)(n.s,0,n.a,n.x,n.e,1)},0):(n(),f()):l=0}function et(n,i,o,h,c,v,y){function d(t){if(!g&&k(p.readyState)&&(b.r=g=1,!l&&f(),p.onload=p.onreadystatechange=null,t)){"img"!=n&&s(function(){rt.removeChild(p)},50);for(var r in u[i])u[i].hasOwnProperty(r)&&u[i][r].onload()}}var y=y||r.errorTimeout,p=t.createElement(n),g=0,w=0,b={t:o,s:i,e:c,a:v,x:y};1===u[i]&&(w=1,u[i]=[]),"object"==n?p.data=i:(p.src=i,p.type=n),p.width=p.height="0",p.onerror=p.onload=p.onreadystatechange=function(){d.call(this,w)},a.splice(h,0,b),"img"!=n&&(w||2===u[i]?(rt.insertBefore(p,nt?null:e),s(d,y)):u[i].push(p))}function ft(n,t,i,r,u){return l=0,t=t||"j",v(n)?et("c"==t?ut:g,n,t,this.i++,i,r,u):(a.splice(this.i++,0,n),1==a.length&&f()),this}function it(){var n=r;return n.loader={load:ft,i:0},n}var o=t.documentElement,s=n.setTimeout,e=t.getElementsByTagName("script")[0],p={}.toString,a=[],l=0,tt="MozAppearance"in o.style,nt=tt&&!!t.createRange().compareNode,rt=nt?o:e.parentNode,o=n.opera&&"[object Opera]"==p.call(n.opera),o=!!t.attachEvent&&!o,g=tt?"object":o?"script":"img",ut=o?"script":g,w=Array.isArray||function(n){return"[object Array]"==p.call(n)},y=[],u={},b={timeout:function(n,t){return t.length&&(n.timeout=t[0]),n}},d,r;r=function(n){function l(n){for(var n=n.split("!"),e=y.length,i=n.pop(),f=n.length,i={url:i,origUrl:i,prefixes:n},u,r,t=0;t<f;t++)r=n[t].split("="),(u=b[r.shift()])&&(i=u(i,r));for(t=0;t<e;t++)i=y[t](i);return i}function o(n,t,r,f,e){var o=l(n),s=o.autoCallback;o.url.split(".").pop().split("?").shift(),o.bypass||(t&&(t=c(t)?t:t[n]||t[f]||t[n.split("/").pop().split("?")[0]]),o.instead?o.instead(n,t,r,f,e):(u[o.url]?o.noexec=!0:u[o.url]=1,r.load(o.url,o.forceCSS||!o.forceJS&&"css"==o.url.split(".").pop().split("?").shift()?"c":i,o.noexec,o.attrs,o.timeout),(c(t)||c(s))&&r.load(function(){it(),t&&t(o.origUrl,e,f),s&&s(o.origUrl,e,f),u[o.url]=2})))}function s(n,t){function l(n,f){if(n){if(v(n))f||(i=function(){var n=[].slice.call(arguments);e.apply(this,n),u()}),o(n,i,t,0,s);else if(Object(n)===n)for(r in a=function(){var i=0,t;for(t in n)n.hasOwnProperty(t)&&i++;return i}(),n)n.hasOwnProperty(r)&&(!f&&!--a&&(c(i)?i=function(){var n=[].slice.call(arguments);e.apply(this,n),u()}:i[r]=function(n){return function(){var t=[].slice.call(arguments);n&&n.apply(this,t),u()}}(e[r])),o(n[r],i,t,r,s))}else!f&&u()}var s=!!n.test,f=n.load||n.both,i=n.callback||h,e=i,u=n.complete||h,a,r;l(s?n.yep:n.nope,!!f),f&&l(f)}var f,t,e=this.yepnope.loader;if(v(n))o(n,0,e,0);else if(w(n))for(f=0;f<n.length;f++)t=n[f],v(t)?o(t,0,e,0):w(t)?r(t):Object(t)===t&&s(t,e);else Object(n)===n&&s(n,e)},r.addPrefix=function(n,t){b[n]=t},r.addFilter=function(n){y.push(n)},r.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",d=function(){t.removeEventListener("DOMContentLoaded",d,0),t.readyState="complete"},0)),n.yepnope=it(),n.yepnope.executeStack=f,n.yepnope.injectJs=function(n,i,u,o,c,l){var a=t.createElement("script"),v,y,o=o||r.errorTimeout;a.src=n;for(y in u)a.setAttribute(y,u[y]);i=l?f:i||h,a.onreadystatechange=a.onload=function(){!v&&k(a.readyState)&&(v=1,i(),a.onload=a.onreadystatechange=null)},s(function(){v||(v=1,i(1))},o),c?a.onload():e.parentNode.insertBefore(a,e)},n.yepnope.injectCss=function(n,i,r,u,o,c){var u=t.createElement("link"),l,i=c?f:i||h;u.href=n,u.rel="stylesheet",u.type="text/css";for(l in r)u.setAttribute(l,r[l]);o||(e.parentNode.insertBefore(u,e),s(i,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},function(n){function i(n,t){return typeof n=="function"?n.call(t):n}function t(t,i){this.$element=n(t),this.options=i,this.enabled=!0,this.fixTitle()}t.prototype={show:function(){var s=this.getTitle(),r;if(s&&this.enabled){r=this.tip(),r.find(".tipsy-inner")[this.options.html?"html":"text"](s),r[0].className="tipsy",r.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var t=n.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),e=r[0].offsetWidth,o=r[0].offsetHeight,f=i(this.options.gravity,this.$element[0]),u;switch(f.charAt(0)){case"n":u={top:t.top+t.height+this.options.offset,left:t.left+t.width/2-e/2};break;case"s":u={top:t.top-o-this.options.offset,left:t.left+t.width/2-e/2};break;case"e":u={top:t.top+t.height/2-o/2,left:t.left-e-this.options.offset};break;case"w":u={top:t.top+t.height/2-o/2,left:t.left+t.width+this.options.offset}}f.length==2&&(u.left=f.charAt(1)=="w"?t.left+t.width/2-15:t.left+t.width/2-e+15),r.css(u).addClass("tipsy-"+f),r.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+f.charAt(0),this.options.className&&r.addClass(i(this.options.className,this.$element[0])),this.options.fade?r.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):r.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){n(this).remove()}):this.tip().remove()},fixTitle:function(){var n=this.$element;(n.attr("title")||typeof n.attr("original-title")!="string")&&n.attr("original-title",n.attr("title")||"").removeAttr("title")},getTitle:function(){var i=this.$element,n=this.options,t;return this.fixTitle(),n=this.options,typeof n.title=="string"?t=i.attr(n.title=="title"?"original-title":n.title):typeof n.title=="function"&&(t=n.title.call(i[0])),t=(""+t).replace(/(^\s*|\s*$)/,""),t||n.fallback},tip:function(){return this.$tip||(this.$tip=n('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>')),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},n.fn.tipsy=function(i){function r(r){var u=n.data(r,"tipsy");return u||(u=new t(r,n.fn.tipsy.elementOptions(r,i)),n.data(r,"tipsy",u)),u}function s(){var n=r(this);n.hoverState="in",i.delayIn==0?n.show():(n.fixTitle(),setTimeout(function(){n.hoverState=="in"&&n.show()},i.delayIn))}function h(){var n=r(this);n.hoverState="out",i.delayOut==0?n.hide():setTimeout(function(){n.hoverState=="out"&&n.hide()},i.delayOut)}var u;if(i===!0)return this.data("tipsy");if(typeof i=="string")return u=this.data("tipsy"),u&&u[i](),this;if(i=n.extend({},n.fn.tipsy.defaults,i),i.live||this.each(function(){r(this)}),i.trigger!="manual"){var f=i.live?"live":"bind",o=i.trigger=="hover"?"mouseenter":"focus",e=i.trigger=="hover"?"mouseleave":"blur";this[f](o,s)[f](e,h)}return this},n.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},n.fn.tipsy.elementOptions=function(t,i){return n.metadata?n.extend({},i,n(t).metadata()):i},n.fn.tipsy.autoNS=function(){return n(this).offset().top>n(document).scrollTop()+n(window).height()/2?"s":"n"},n.fn.tipsy.autoWE=function(){return n(this).offset().left>n(document).scrollLeft()+n(window).width()/2?"e":"w"},n.fn.tipsy.autoBounds=function(t,i){return function(){var r={ns:i[0],ew:i.length>1?i[1]:!1},f=n(document).scrollTop()+t,e=n(document).scrollLeft()+t,u=n(this);return u.offset().top<f&&(r.ns="n"),u.offset().left<e&&(r.ew="w"),n(window).width()+n(document).scrollLeft()-u.offset().left<t&&(r.ew="e"),n(window).height()+n(document).scrollTop()-u.offset().top<t&&(r.ns="s"),r.ns+(r.ew?r.ew:"")}}}(jQuery),function(n){n.cookie=function(t,i,r){var h,o,s,f,u,e;if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(i))||i===null||i===undefined))return r=n.extend({},r),(i===null||i===undefined)&&(r.expires=-1),typeof r.expires=="number"&&(h=r.expires,o=r.expires=new Date,o.setDate(o.getDate()+h)),i=String(i),document.cookie=[encodeURIComponent(t),"=",r.raw?i:encodeURIComponent(i),r.expires?"; expires="+r.expires.toUTCString():"",r.path?"; path="+r.path:"",r.domain?"; domain="+r.domain:"",r.secure?"; secure":""].join("");for(r=i||{},s=r.raw?function(n){return n}:decodeURIComponent,f=document.cookie.split("; "),u=0;e=f[u]&&f[u].split("=");u++)if(s(e[0])===t)return s(e[1]||"");return null}}(jQuery),function(n,t,i){n.fn.jScrollPane=function(t){function r(t,r){function ci(r){var k,tt,it,h,y,p,d=!1,g=!1;if(u=r,e===i)y=t.scrollTop(),p=t.scrollLeft(),t.css({overflow:"hidden",padding:0}),s=t.innerWidth()+st,o=t.innerHeight(),t.width(s),e=n('<div class="jspPane" />').css("padding",vi).append(t.children()),f=n('<div class="jspContainer" />').css({width:s+"px",height:o+"px"}).append(e).appendTo(t);else{if(t.css("width",""),d=u.stickToBottom&&wr(),g=u.stickToRight&&yr(),h=t.innerWidth()+st!=s||t.outerHeight()!=o,h&&(s=t.innerWidth()+st,o=t.innerHeight(),f.css({width:s+"px",height:o+"px"})),!h&&gi==v&&e.outerHeight()==a){t.width(s);return}gi=v,e.css("width",""),t.width(s),f.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}e.css("overflow","auto"),v=r.contentWidth?r.contentWidth:e[0].scrollWidth,a=e[0].scrollHeight,e.css("overflow",""),ei=v/s,ri=a/o,b=ri>1,w=ei>1,w||b?(t.addClass("jspScrollable"),k=u.maintainPosition&&(c||l),k&&(tt=ft(),it=et()),ar(),vr(),lr(),k&&(vt(g?v-s:tt,!1),nt(d?a-o:it,!1)),tr(),pr(),fr(),u.enableKeyboardNavigation&&ur(),u.clickOnTrack&&cr(),er(),u.hijackInternalLinks&&nr()):(t.removeClass("jspScrollable"),e.css({top:0,width:f.width()-st}),sr(),rr(),ir(),ki(),bi()),u.autoReinitialise&&!ti?ti=setInterval(function(){ci(u)},u.autoReinitialiseDelay):!u.autoReinitialise&&ti&&clearInterval(ti),y&&t.scrollTop(0)&&nt(y,!1),p&&t.scrollLeft(0)&&vt(p,!1),t.trigger("jsp-initialised",[w||b])}function ar(){b&&(f.append(n('<div class="jspVerticalBar" />').append(n('<div class="jspCap jspCapTop" />'),n('<div class="jspTrack" />').append(n('<div class="jspDrag" />').append(n('<div class="jspDragTop" />'),n('<div class="jspDragBottom" />'))),n('<div class="jspCap jspCapBottom" />'))),ui=f.find(">.jspVerticalBar"),k=ui.find(">.jspTrack"),p=k.find(">.jspDrag"),u.showArrows&&(pt=n('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",tt(0,-1)).bind("click.jsp",at),kt=n('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",tt(0,1)).bind("click.jsp",at),u.arrowScrollOnHover&&(pt.bind("mouseover.jsp",tt(0,-1,pt)),kt.bind("mouseover.jsp",tt(0,1,kt))),di(k,u.verticalArrowPositions,pt,kt)),lt=o,f.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){lt-=n(this).outerHeight()}),p.hover(function(){p.addClass("jspHover")},function(){p.removeClass("jspHover")}).bind("mousedown.jsp",function(t){n("html").bind("dragstart.jsp selectstart.jsp",at),p.addClass("jspActive");var i=t.pageY-p.position().top;return n("html").bind("mousemove.jsp",function(n){ot(n.pageY-i,!1)}).bind("mouseup.jsp mouseleave.jsp",yi),!1}),pi())}function pi(){k.height(lt+"px"),c=0,oi=u.verticalGutter+k.outerWidth(),e.width(s-oi-st);try{ui.position().left===0&&e.css("margin-left",oi+"px")}catch(n){}}function vr(){w&&(f.append(n('<div class="jspHorizontalBar" />').append(n('<div class="jspCap jspCapLeft" />'),n('<div class="jspTrack" />').append(n('<div class="jspDrag" />').append(n('<div class="jspDragLeft" />'),n('<div class="jspDragRight" />'))),n('<div class="jspCap jspCapRight" />'))),ni=f.find(">.jspHorizontalBar"),d=ni.find(">.jspTrack"),y=d.find(">.jspDrag"),u.showArrows&&(wt=n('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",tt(-1,0)).bind("click.jsp",at),bt=n('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",tt(1,0)).bind("click.jsp",at),u.arrowScrollOnHover&&(wt.bind("mouseover.jsp",tt(-1,0,wt)),bt.bind("mouseover.jsp",tt(1,0,bt))),di(d,u.horizontalArrowPositions,wt,bt)),y.hover(function(){y.addClass("jspHover")},function(){y.removeClass("jspHover")}).bind("mousedown.jsp",function(t){n("html").bind("dragstart.jsp selectstart.jsp",at),y.addClass("jspActive");var i=t.pageX-y.position().left;return n("html").bind("mousemove.jsp",function(n){ct(n.pageX-i,!1)}).bind("mouseup.jsp mouseleave.jsp",yi),!1}),ht=f.innerWidth(),wi())}function wi(){f.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){ht-=n(this).outerWidth()}),d.width(ht+"px"),l=0}function lr(){if(w&&b){var t=d.outerHeight(),i=k.outerWidth();lt-=t,n(ni).find(">.jspCap:visible,>.jspArrow").each(function(){ht+=n(this).outerWidth()}),ht-=i,o-=i,s-=t,d.parent().append(n('<div class="jspCorner" />').css("width",t+"px")),pi(),wi()}w&&e.width(f.outerWidth()-st+"px"),a=e.outerHeight(),ri=a/o,w&&(it=Math.ceil(1/ei*ht),it>u.horizontalDragMaxWidth?it=u.horizontalDragMaxWidth:it<u.horizontalDragMinWidth&&(it=u.horizontalDragMinWidth),y.width(it+"px"),rt=ht-it,si(l)),b&&(ut=Math.ceil(1/ri*lt),ut>u.verticalDragMaxHeight?ut=u.verticalDragMaxHeight:ut<u.verticalDragMinHeight&&(ut=u.verticalDragMinHeight),p.height(ut+"px"),g=lt-ut,hi(c))}function di(n,t,i,r){var f="before",u="after",e;t=="os"&&(t=/Mac/.test(navigator.platform)?"after":"split"),t==f?u=t:t==u&&(f=t,e=i,i=r,r=e),n[f](i)[u](r)}function tt(n,t,i){return function(){return hr(n,t,this,i),this.blur(),!1}}function hr(t,i,r,f){r=n(r).addClass("jspActive");var o,e,c=!0,s=function(){t!==0&&h.scrollByX(t*u.arrowButtonSpeed),i!==0&&h.scrollByY(i*u.arrowButtonSpeed),e=setTimeout(s,c?u.initialDelay:u.arrowRepeatFreq),c=!1};s(),o=f?"mouseout.jsp":"mouseup.jsp",f=f||n("html"),f.bind(o,function(){r.removeClass("jspActive"),e&&clearTimeout(e),e=null,f.unbind(o)})}function cr(){ki(),b&&k.bind("mousedown.jsp",function(t){if(t.originalTarget===i||t.originalTarget==t.currentTarget){var v=n(this),y=v.offset(),e=t.pageY-y.top-c,r,l=!0,s=function(){var p=v.offset(),n=t.pageY-p.top-ut/2,i=o*u.scrollPagePercent,y=g*i/(a-o);if(e<0)c-y>n?h.scrollByY(-i):ot(n);else if(e>0)c+y<n?h.scrollByY(i):ot(n);else{f();return}r=setTimeout(s,l?u.initialDelay:u.trackClickRepeatFreq),l=!1},f=function(){r&&clearTimeout(r),r=null,n(document).unbind("mouseup.jsp",f)};return s(),n(document).bind("mouseup.jsp",f),!1}}),w&&d.bind("mousedown.jsp",function(t){if(t.originalTarget===i||t.originalTarget==t.currentTarget){var a=n(this),y=a.offset(),e=t.pageX-y.left-l,r,c=!0,o=function(){var p=a.offset(),n=t.pageX-p.left-it/2,i=s*u.scrollPagePercent,y=rt*i/(v-s);if(e<0)l-y>n?h.scrollByX(-i):ct(n);else if(e>0)l+y<n?h.scrollByX(i):ct(n);else{f();return}r=setTimeout(o,c?u.initialDelay:u.trackClickRepeatFreq),c=!1},f=function(){r&&clearTimeout(r),r=null,n(document).unbind("mouseup.jsp",f)};return o(),n(document).bind("mouseup.jsp",f),!1}})}function ki(){d&&d.unbind("mousedown.jsp"),k&&k.unbind("mousedown.jsp")}function yi(){n("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),p&&p.removeClass("jspActive"),y&&y.removeClass("jspActive")}function ot(n,t){b&&(n<0?n=0:n>g&&(n=g),t===i&&(t=u.animateScroll),t?h.animate(p,"top",n,hi):(p.css("top",n),hi(n)))}function hi(n){n===i&&(n=p.position().top),f.scrollTop(0),c=n;var u=c===0,r=c==g,h=n/g,s=-h*(a-o);(ii!=u||gt!=r)&&(ii=u,gt=r,t.trigger("jsp-arrow-change",[ii,gt,fi,dt])),br(u,r),e.css("top",s),t.trigger("jsp-scroll-y",[-s,u,r]).trigger("scroll")}function ct(n,t){w&&(n<0?n=0:n>rt&&(n=rt),t===i&&(t=u.animateScroll),t?h.animate(y,"left",n,si):(y.css("left",n),si(n)))}function si(n){n===i&&(n=y.position().left),f.scrollTop(0),l=n;var u=l===0,r=l==rt,h=n/rt,o=-h*(v-s);(fi!=u||dt!=r)&&(fi=u,dt=r,t.trigger("jsp-arrow-change",[ii,gt,fi,dt])),kr(u,r),e.css("left",o),t.trigger("jsp-scroll-x",[-o,u,r]).trigger("scroll")}function br(n,t){u.showArrows&&(pt[n?"addClass":"removeClass"]("jspDisabled"),kt[t?"addClass":"removeClass"]("jspDisabled"))}function kr(n,t){u.showArrows&&(wt[n?"addClass":"removeClass"]("jspDisabled"),bt[t?"addClass":"removeClass"]("jspDisabled"))}function nt(n,t){var i=n/(a-o);ot(i*g,t)}function vt(n,t){var i=n/(v-s);ct(i*rt,t)}function yt(t,i,r){var e,p,v,h=0,c=0,w,y,b,k,a,l;try{e=n(t)}catch(d){return}for(p=e.outerHeight(),v=e.outerWidth(),f.scrollTop(0),f.scrollLeft(0);!e.is(".jspPane");)if(h+=e.position().top,c+=e.position().left,e=e.offsetParent(),/^body|html$/i.test(e[0].nodeName))return;w=et(),b=w+o,h<w||i?a=h-u.verticalGutter:h+p>b&&(a=h-o+p+u.verticalGutter),a&&nt(a,r),y=ft(),k=y+s,c<y||i?l=c-u.horizontalGutter:c+v>k&&(l=c-s+v+u.horizontalGutter),l&&vt(l,r)}function ft(){return-e.position().left}function et(){return-e.position().top}function wr(){var n=a-o;return n>20&&n-et()<10}function yr(){var n=v-s;return n>20&&n-ft()<10}function pr(){f.unbind(li).bind(li,function(n,t,i,r){var e=l,f=c;return h.scrollBy(i*u.mouseWheelSpeed,-r*u.mouseWheelSpeed,!1),e==l&&f==c})}function sr(){f.unbind(li)}function at(){return!1}function tr(){e.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(n){yt(n.target,!1)})}function rr(){e.find(":input,a").unbind("focus.jsp")}function ur(){function v(){var t=l,n=c;switch(i){case 40:h.scrollByY(u.keyboardSpeed,!1);break;case 38:h.scrollByY(-u.keyboardSpeed,!1);break;case 34:case 32:h.scrollByY(o*u.scrollPagePercent,!1);break;case 33:h.scrollByY(-o*u.scrollPagePercent,!1);break;case 39:h.scrollByX(u.keyboardSpeed,!1);break;case 37:h.scrollByX(-u.keyboardSpeed,!1)}return r=t!=l||n!=c}var i,r,s=[];w&&s.push(ni[0]),b&&s.push(ui[0]),e.focus(function(){t.focus()}),t.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(t){if(t.target===this||s.length&&n(t.target).closest(s).length){var f=l,u=c;switch(t.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:i=t.keyCode,v();break;case 35:nt(a-o),i=null;break;case 36:nt(0),i=null}return r=t.keyCode==i&&f!=l||u!=c,!r}}).bind("keypress.jsp",function(n){return n.keyCode==i&&v(),!r}),u.hideFocus?(t.css("outline","none"),"hideFocus"in f[0]&&t.attr("hideFocus",!0)):(t.css("outline",""),"hideFocus"in f[0]&&t.attr("hideFocus",!1))}function ir(){t.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function er(){if(location.hash&&location.hash.length>1){var r,i,t=escape(location.hash);try{r=n(t)}catch(u){return}r.length&&e.find(t)&&(f.scrollTop()===0?i=setInterval(function(){f.scrollTop()>0&&(yt(t,!0),n(document).scrollTop(f.position().top),clearInterval(i))},50):(yt(t,!0),n(document).scrollTop(f.position().top)))}}function bi(){n("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function nr(){bi(),n("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var t=this.href.split("#"),n;if(t.length>1&&(n=t[1],n.length>0&&e.find("#"+n).length>0))return yt("#"+n,!0),!1})}function fr(){var u,e,r,t,n,i=!1;f.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(f){var o=f.originalEvent.touches[0];u=ft(),e=et(),r=o.pageX,t=o.pageY,n=!1,i=!0}).bind("touchmove.jsp",function(f){if(i){var o=f.originalEvent.touches[0],a=l,s=c;return h.scrollTo(u+r-o.pageX,e+t-o.pageY),n=n||Math.abs(r-o.pageX)>5||Math.abs(t-o.pageY)>5,a==l&&s==c}}).bind("touchend.jsp",function(){i=!1}).bind("click.jsp-touchclick",function(){if(n)return n=!1,!1})}function or(){var i=et(),n=ft();t.removeClass("jspScrollable").unbind(".jsp"),t.replaceWith(ai.append(e.children())),ai.scrollTop(i),ai.scrollLeft(n)}var u,h=this,e,s,o,f,v,a,ei,ri,b,w,p,g,c,y,rt,l,ui,k,oi,lt,ut,pt,kt,ni,d,ht,it,wt,bt,ti,vi,st,gi,ii=!0,fi=!0,gt=!1,dt=!1,ai=t.clone(!1,!1).empty(),li=n.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";vi=t.css("paddingTop")+" "+t.css("paddingRight")+" "+t.css("paddingBottom")+" "+t.css("paddingLeft"),st=(parseInt(t.css("paddingLeft"),10)||0)+(parseInt(t.css("paddingRight"),10)||0),n.extend(h,{reinitialise:function(t){t=n.extend({},u,t),ci(t)},scrollToElement:function(n,t,i){yt(n,t,i)},scrollTo:function(n,t,i){vt(n,i),nt(t,i)},scrollToX:function(n,t){vt(n,t)},scrollToY:function(n,t){nt(n,t)},scrollToPercentX:function(n,t){vt(n*(v-s),t)},scrollToPercentY:function(n,t){nt(n*(a-o),t)},scrollBy:function(n,t,i){h.scrollByX(n,i),h.scrollByY(t,i)},scrollByX:function(n,t){var r=ft()+Math[n<0?"floor":"ceil"](n),i=r/(v-s);ct(i*rt,t)},scrollByY:function(n,t){var r=et()+Math[n<0?"floor":"ceil"](n),i=r/(a-o);ot(i*g,t)},positionDragX:function(n,t){ct(n,t)},positionDragY:function(n,t){ot(n,t)},animate:function(n,t,i,r){var f={};f[t]=i,n.animate(f,{duration:u.animateDuration,easing:u.animateEase,queue:!1,step:r})},getContentPositionX:function(){return ft()},getContentPositionY:function(){return et()},getContentWidth:function(){return v},getContentHeight:function(){return a},getPercentScrolledX:function(){return ft()/(v-s)},getPercentScrolledY:function(){return et()/(a-o)},getIsScrollableH:function(){return w},getIsScrollableV:function(){return b},getContentPane:function(){return e},scrollToBottom:function(n){ot(g,n)},hijackInternalLinks:function(){nr()},destroy:function(){or()}}),ci(r)}return t=n.extend({},n.fn.jScrollPane.defaults,t),n.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){t[this]=t[this]||t.speed}),this.each(function(){var u=n(this),i=u.data("jsp");i?i.reinitialise(t):(i=new r(u,t),u.data("jsp",i))})},n.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:i,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}}(jQuery,this),function(n){function i(t){var i=t||window.event,e=[].slice.call(arguments,1),r=0,o=!0,f=0,u=0;return t=n.event.fix(i),t.type="mousewheel",i.wheelDelta&&(r=i.wheelDelta/120),i.detail&&(r=-i.detail/3),u=r,i.axis!==undefined&&i.axis===i.HORIZONTAL_AXIS&&(u=0,f=-1*r),i.wheelDeltaY!==undefined&&(u=i.wheelDeltaY/120),i.wheelDeltaX!==undefined&&(f=i.wheelDeltaX/-120),e.unshift(t,r,f,u),(n.event.dispatch||n.event.handle).apply(this,e)}var t=["DOMMouseScroll","mousewheel"],r;if(n.event.fixHooks)for(r=t.length;r;)n.event.fixHooks[t[--r]]=n.event.mouseHooks;n.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var n=t.length;n;)this.addEventListener(t[--n],i,!1);else this.onmousewheel=i},teardown:function(){if(this.removeEventListener)for(var n=t.length;n;)this.removeEventListener(t[--n],i,!1);else this.onmousewheel=null}},n.fn.extend({mousewheel:function(n){return n?this.bind("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.unbind("mousewheel",n)}})}(jQuery),function(n){var c={className:"autosizejs",append:"",callback:!1},u="hidden",r="border-box",o="lineHeight",h='<textarea tabindex="-1" style="position:absolute; top:-9999px; left:-9999px; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden;"/>',s=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],i="oninput",e="onpropertychange",f,t=n(h).data("autosize",!0)[0];t.style.lineHeight="99px",n(t).css(o)==="99px"&&s.push(o),t.style.lineHeight="",n.fn.autosize=function(o){return o=n.extend({},c,o||{}),t.parentNode!==document.body&&n(document.body).append(t),this.each(function(){function b(){f=h,t.className=o.className,n.each(s,function(n,i){t.style[i]=c.css(i)})}function l(){var n,r,e,i;f!==h&&b(),a||(a=!0,t.value=h.value+o.append,t.style.overflowY=h.style.overflowY,e=parseInt(h.style.height,10),t.style.width=c.width()+"px",t.scrollTop=0,t.scrollTop=9e4,n=t.scrollTop,i=parseInt(c.css("maxHeight"),10),i=i&&i>0?i:9e4,n>i?(n=i,r="scroll"):n<p&&(n=p),n+=y,h.style.overflowY=r||u,e!==n&&(h.style.height=n+"px",w&&o.callback.call(h)),setTimeout(function(){a=!1},1))}var h=this,c=n(h).addClass("autosize"),p=c.height(),a,v,y=0,w=n.isFunction(o.callback);c.data("autosize")||((c.css("box-sizing")===r||c.css("-moz-box-sizing")===r||c.css("-webkit-box-sizing")===r)&&(y=c.outerHeight()-c.height()),v=c.css("resize")==="none"||c.css("resize")==="vertical"?"none":"horizontal",c.css({overflow:u,overflowY:u,wordWrap:"break-word",resize:v}).data("autosize",!0),e in h?i in h?h[i]=h.onkeyup=l:h[e]=h.onkeyup=l:h[i]=l,c.bind("autosize",l),l())})}}(window.jQuery||window.Zepto),function(n){n.fn.returnTab=function(){this.each(function(){n(this).bind("keypress.returnTab",function(t){var r,i,u;if(t.which==13)return r=n(":input:enabled:visible"),i=r.index(t.target),t.preventDefault(),i=i==r.length-1?0:i+1,u=r[i],u.focus(),!1})})}}(jQuery),function(n){n.fn.moveTo=function(t){return this.each(function(){var i=n(this).clone();n(i).appendTo(t),n(this).remove()})}}(jQuery),$(document).ready(function(){var t=[],f=function(n,t){var e,i,r,s;if(!t)return n;var o=[],l=[],h=[],f=[o,h,l],u=[],c=[];for(i=0;i<n.length;i++)o.push(n[i].username),h.push(n[i].firstname+" "+n[i].lastname),l.push(n[i].lastname);for(t=t.toLowerCase(),e=function(n){for(var t=0;t<u.length;t++)if(u[t]==n)return!0;return!1},i=0;i<f.length;i++)for(r=0;r<f[i].length;r++)e(r)||(s=f[i][r].toLowerCase(),s.indexOf(t)==0&&(c.push(n[r]),u.push(r)));return c},u=function(n,t,i,u){var e=$('<ul id="at-username-autocomplete"></ul>'),f,o;if(u.setUsernameListPosition&&u.setUsernameListPosition(n,e),i.length){for(f=0;f<i.length;f++){if(f===u.numResults){o=i.length-f,e.append($('<li class="ac-msg">'+kendo.format(u.moreUsersMessage,o)+"</li>"));break}e.append($('<li data-username="'+i[f].username+'"><span class="ac-username">'+i[f].username+'</span><span class="ac-fullname">, '+i[f].firstname+" "+i[f].lastname+"</span></li>"))}e.find("li:first-child").addClass("active")}else e.append($('<li class="ac-msg">'+u.noMatchMessage+"</li>"));return e.find("li").click(function(t){if($(this).hasClass("ac-msg"))t.stopPropagation();else return $("#at-username-autocomplete").find("li").removeClass("active"),$(this).addClass("active"),r(n),n.focus(),!1}),e},n=function(){var n=$("#at-username-autocomplete"),t;n.length>0&&(t=n.parent().find("textarea"),n.remove(),t.removeClass("autocomplete_active").removeData("ac_start").scrollTop(9999))},i=function(n){var t=n[0],u=0,f,i,r;if(t.selectionStart>=0)u=t.selectionStart;else if(t.ownerDocument.selection){if(f=t.ownerDocument.selection.createRange(),!f)return 0;i=t.createTextRange(),r=i.duplicate(),i.moveToBookmark(f.getBookmark()),r.setEndPoint("EndToStart",i),u=r.text.length}return u},e=function(n,t){var i=n[0],r;i.selectionStart?(i.selectionStart=t,i.selectionEnd=t):i.ownerDocument.selection&&(i.focus(),r=i.ownerDocument.selection.createRange(),r.moveStart("character",-i.value.length),r.moveEnd("character",-i.value.length),r.moveStart("character",t),r.moveEnd("character",0),r.select())},r=function(t){var u=$("#at-username-autocomplete").find("li.active");if(u.length>0){var i=u.attr("data-username"),o=new RegExp("[^\\w]"),r=t.data("ac_start"),f=r+t.data("ac_skip");i.match(o)&&(i=i+"@"),i=i+" ",t.val(t.val().substring(0,r)+i+t.val().substring(f,t.val().length)),e(t,r+i.length)}n(),t.attr("cancel-close",!1)};$.fn.atUsername=function(e){var o={numResults:5};e!==undefined&&jQuery.extend(o,e),t=o.source,this.data("at-show",!1),typeof this.data("at-username")=="undefined"&&(this.data("at-username",!0),$("#feedPane").click(n),this.bind("keydown",function(n){return n.which===50&&n.shiftKey&&$(this).data("ac-show",!0),(n.which===13||n.which===9||n.which===38||n.which===40)&&$("#at-username-autocomplete").length>0?(n.preventDefault(),!1):void 0}),this.bind("keyup",function(e){var s=$(this),c=$("#at-username-autocomplete"),l,b,d,h,k,a,w,v,g,p,y,nt;if(e.which!==16||s.data("ac-show")!==!1){if(e.which===27){n(),s.val(s.val());return}if(e.which===50&&(e.shiftKey||s.data("ac-show")===!0)){if(b=i(s),d=s.val()[b-2],s.data("ac-show",!1),b==1||$.inArray(d,[" ",".",",",";",])>-1||d.match(new RegExp(/\r\n|\r|\n/)))s.addClass("autocomplete_active"),s.attr("cancel-close",!0),s.data("ac_skip",0);else return!0;if(s.data("ac_start")||s.data("ac_start",b),t.length===0)return!0;l=u(s,s.closest(".at-username-container"),t,o),c.length>0?c.replaceWith(l):o.getElementToAppendUsernameListTo?o.getElementToAppendUsernameListTo(s).append(l):s.parent().append(l)}else if(e.which===38||e.which===40||e.which===13||e.which===9){if(c.length===0)return;switch(e.which){case 38:return h=c.find("li.active"),h.removeClass("active"),k=h.length>0?h.prev():[],k.length>0&&!k.hasClass("ac-msg")?k.addClass("active"):(a=c.find("li:last-child"),a.hasClass("ac-msg")?a.prev().hasClass("ac-msg")||a.prev().addClass("active"):a.addClass("active")),!1;case 40:return h=c.find("li.active"),h.removeClass("active"),w=h.length>0?h.next():[],w.length>0&&!w.hasClass("ac-msg")?w.addClass("active"):(v=c.find("li:first-child"),v.hasClass("ac-msg")?v.next().hasClass("ac-msg")||v.next().addClass("active"):v.addClass("active")),!1;case 9:case 13:return r(s),!1}}else{if(!s.hasClass("autocomplete_active"))return!0;if(g=s.data("ac_start"),p=i(s)+1,(e.which===8||e.which===37)&&p--,p<g)return n(),s.attr("cancel-close",!1),!0;y=s.val().substring(g,p),s.data("ac_skip",y.length),y=y.toLowerCase(),nt=f(t,y),l=u(s,s.closest(".at-username-container"),nt,o),c.replaceWith(l)}}}))}}),function(n){"use strict";function t(){this._events={},this._maxListeners=10}function i(n,t,i,r,u){this.type=n,this.listener=t,this.scope=i,this.once=r,this.instance=u}i.prototype.fire=function(n){if(this.listener.apply(this.scope||this.instance,n),this.once){var t=this.instance.listeners(this.type).length;if(this.instance.removeListener(this.type,this.listener,this.scope),t!==this.instance.listeners(this.type).length)return!1}},t.prototype.eachListener=function(n,t){var i=null,u=null,r=null;if(this._events.hasOwnProperty(n))for(u=this._events[n],i=0;i<u.length;i+=1)if(r=t.call(this,u[i],i),r===!1)i-=1;else if(r===!0)break;return this},t.prototype.addListener=function(n,t,r,u){return this._events.hasOwnProperty(n)||(this._events[n]=[]),this._events[n].push(new i(n,t,r,u,this)),this.emit("newListener",n,t,r,u),this._maxListeners&&!this._events[n].warned&&this._events[n].length>this._maxListeners&&(typeof console!="undefined"&&console.warn("Possible EventEmitter memory leak detected. "+this._events[n].length+" listeners added. Use emitter.setMaxListeners() to increase limit."),this._events[n].warned=!0),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(n,t,i){return this.addListener(n,t,i,!0)},t.prototype.removeListener=function(n,t,i){return this.eachListener(n,function(r,u){r.listener===t&&(!i||r.scope===i)&&this._events[n].splice(u,1)}),this._events[n]&&this._events[n].length===0&&delete this._events[n],this},t.prototype.off=t.prototype.removeListener,t.prototype.removeAllListeners=function(n){return n&&this._events.hasOwnProperty(n)?delete this._events[n]:n||(this._events={}),this},t.prototype.listeners=function(n){if(this._events.hasOwnProperty(n)){var t=[];return this.eachListener(n,function(n){t.push(n.listener)}),t}return[]},t.prototype.emit=function(n){for(var i=[],t=null,t=1;t<arguments.length;t+=1)i.push(arguments[t]);return this.eachListener(n,function(n){return n.fire(i)}),this},t.prototype.setMaxListeners=function(n){return this._maxListeners=n,this},t.extend=function(){var i={},t=this.prototype,n=null;for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);return i},typeof define=="function"&&define.amd&&define(function(){return t}),n.EventEmitter=t}(this),function(n,t,i){function e(n){return n}function f(n){return decodeURIComponent(n.replace(u," "))}var u=/\+/g,r=n.cookie=function(u,o,s){var p,v,y,a,h,l,c;if(o!==i)return s=n.extend({},r.defaults,s),o===null&&(s.expires=-1),typeof s.expires=="number"&&(p=s.expires,v=s.expires=new Date,v.setDate(v.getDate()+p)),o=r.json?JSON.stringify(o):String(o),t.cookie=[encodeURIComponent(u),"=",r.raw?o:encodeURIComponent(o),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("");for(y=r.raw?e:f,a=t.cookie.split("; "),h=0;l=a[h]&&a[h].split("=");h++)if(y(l.shift())===u)return c=y(l.join("=")),r.json?JSON.parse(c):c;return null};r.defaults={},n.removeCookie=function(t,i){return n.cookie(t)!==null?(n.cookie(t,null,i),!0):!1}}(jQuery,document),function(n){var t=n.fn.hover,i=function(i,r,u){return n(this).each(function(){var f;t.call(n(this),function(n){if(f)f=clearTimeout(f);else{var t=this;f=setTimeout(function(){f=undefined,i.call(t,n)},u)}},function(n){if(f)f=clearTimeout(f);else{var t=this;f=setTimeout(function(){f=undefined,r.call(t,n)},u)}})})};n.fn.hover=function(n,r,u){return typeof u=="number"?i.call(this,n,r,u):t.call(this,n,r),this}}(jQuery),function(n,t){function i(n){if(n&&n.__wrapped__)return n;if(!(this instanceof i))return new i(n);this.__wrapped__=n}function ei(n,t,i){var u;t||(t=0);var e=n.length,f=e-t>=(i||au),r=f?{}:n;if(f)for(i=t-1;++i<e;)u=n[i]+"",(c.call(r,u)?r[u]:r[u]=[]).push(n[i]);return function(n){if(f){var i=n+"";return c.call(r,i)&&-1<d(r[i],n)}return-1<d(r,n,t)}}function bu(n,i){var u=n.b,r=i.b,n=n.a,i=i.a;if(n!==i){if(n>i||n===t)return 1;if(n<i||i===t)return-1}return u<r?-1:1}function fi(n,t,i){function u(){var o=arguments,s=r?this:t;return e||(n=t[f]),i.length&&(o=o.length?i.concat(h.call(o)):i),this instanceof u?(dr.prototype=n.prototype,s=new dr,(o=n.apply(s,o))&&tt[typeof o]?o:s):n.apply(s,o)}var e=l(n),r=!i,f=n;return r&&(i=t),u}function s(n,i){return n?"function"!=typeof n?function(t){return t[n]}:i!==t?function(t,r,u){return n.call(i,t,r,u)}:n:ki}function rt(){for(var r,i,n={b:"",c:"",e:vi,f:eu,g:"",h:nr,i:or,j:ru,k:"",l:o},t=0;r=arguments[t];t++)for(i in r)n[i]=r[i];if(r=n.a,n.d=/^[^,]+/.exec(r)[0],t="var h,w,j="+n.d+",r="+n.d+";if(!"+n.d+")return r;"+n.k+";",n.b?(t+="var k=j.length;h=-1;if(typeof k=='number'){",n.i&&(t+="if(v.call(j)==t){j=j.split('')}"),t+="while(++h<k){w=j[h];"+n.b+"}}else {"):n.h&&(t+="var k=j.length;h=-1;if(k&&i(j)){while(++h<k){w=j[h+=''];"+n.g+"}}else {"),n.e||(t+="var s=typeof j=='function'&&q.call(j,'prototype');"),n.f&&n.l?(t+="var o=-1,p=n[typeof j]?l(j):[],k=p.length;while(++o<k){h=p[o];",n.e||(t+="if(!(s&&h=='prototype')){"),t+="w=j[h];"+n.g+"",n.e||(t+="}")):(t+="for(h in j){",(!n.e||n.l)&&(t+="if(",n.e||(t+="!(s&&h=='prototype')"),!n.e&&n.l&&(t+="&&"),n.l&&(t+="g.call(j,h)"),t+="){"),t+="w=j[h];"+n.g+";",(!n.e||n.l)&&(t+="}")),t+="}",n.e)for(t+="var f=j.constructor;",i=0;7>i;i++)t+="h='"+n.j[i]+"';if(","constructor"==n.j[i]&&(t+="!(f&&f.prototype===j)&&"),t+="g.call(j,h)){w=j[h];"+n.g+"}";return(n.b||n.h)&&(t+="}"),t+=n.c+";return r",Function("e,g,i,n,l,q,t,v","return function("+r+"){"+t+"}")(s,c,y,tt,k,tu,p,e)}function wu(n){return"\\"+uu[n]}function ku(n){return lr[n]}function dr(){}function gu(n){return su[n]}function y(n){return e.call(n)==yt}function ur(n){var t=r,i;return!n||"object"!=typeof n||y(n)?t:(i=n.constructor,(!si||"function"==typeof n.toString||"string"!=typeof(n+""))&&(!l(i)||i instanceof i)?sr?(b(n,function(n,i,u){return t=!c.call(u,i),r}),t===r):(b(n,function(n,i){t=i}),t===r||c.call(n,t)):t)}function tr(n){var t=[];return w(n,function(n,i){t.push(i)}),t}function gi(n,t,i,o,s){var c,l,i,a;if(n==u)return n;if(i&&(t=r),i=tt[typeof n]){if(c=e.call(n),!v[c]||ht&&y(n))return n;l=c==ut,i=l||(c==ft?ct(n):i)}if(!i||!t)return i?l?h.call(n):pr({},n):n;i=n.constructor;switch(c){case at:case wt:return new i(+n);case et:case p:return new i(n);case st:return i(n.source,sf.exec(n))}for(o||(o=[]),s||(s=[]),c=o.length;c--;)if(o[c]==n)return s[c];return a=l?i(n.length):{},o.push(n),s.push(a),(l?f:w)(n,function(n,i){a[i]=gi(n,t,u,o,s)}),a}function dt(n){var t=[];return b(n,function(n,i){l(n)&&t.push(i)}),t.sort()}function hr(n){var t={};return w(n,function(n,i){t[n]=i}),t}function ot(n,t,i,f){var w,s,a,h;if(n===t)return 0!==n||1/n==1/t;if(n==u||t==u)return n===t;if(s=e.call(n),s!=e.call(t))return r;switch(s){case at:case wt:return+n==+t;case et:return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case st:case p:return n==t+""}if(w=s==ut||s==yt,ht&&!w&&(w=y(n))&&!y(t))return r;if(!w){if(n.__wrapped__||t.__wrapped__)return ot(n.__wrapped__||n,t.__wrapped__||t);if(s!=ft||si&&("function"!=typeof n.toString&&"string"==typeof(n+"")||"function"!=typeof t.toString&&"string"==typeof(t+""))||(s=n.constructor,a=t.constructor,s!=a&&(!l(s)||!(s instanceof s&&l(a)&&a instanceof a))))return r}for(i||(i=[]),f||(f=[]),s=i.length;s--;)if(i[s]==n)return f[s]==t;var s=-1,a=o,v=0;if(i.push(n),f.push(t),w){if(v=n.length,a=v==t.length)for(;v--&&(a=ot(n[v],t[v],i,f)););return a}for(h in n)if(c.call(n,h)&&(v++,!c.call(t,h)||!ot(n[h],t[h],i,f)))return r;for(h in t)if(c.call(t,h)&&!v--)return r;if(vi)for(;7>++s;)if(h=ru[s],c.call(n,h)&&(!c.call(t,h)||!ot(n[h],t[h],i,f)))return r;return o}function l(n){return"function"==typeof n}function er(n,t,i){var e=arguments,s=0,o=2,r=e[3],f=e[4];for(i!==ar&&(r=[],f=[],o=e.length);++s<o;)w(e[s],function(t,i){var s,h,e,o;if(t&&((h=it(t))||ct(t))){for(o=r.length;o--;)if(s=r[o]==t)break;s?n[i]=f[o]:(r.push(t),f.push(e=(e=n[i],h)?it(e)?e:[]:ct(e)?e:{}),n[i]=er(e,t,ar,r,f))}else t!=u&&(n[i]=t)});return n}function fr(n){var t=[];return w(n,function(n){t.push(n)}),t}function ir(n,t){return"number"==typeof(n?n.length:0)?-1<(e.call(n)==p?n.indexOf(t):d(n,t)):kt(n,function(n){return n===t})}function rr(n,t,i){var r=o,t=s(t,i);return f(n,function(n,i,u){return r=!!t(n,i,u)}),r}function gt(n,t,i){var r=[],t=s(t,i);return f(n,function(n,i,u){t(n,i,u)&&r.push(n)}),r}function di(n,t,i){var r,t=s(t,i);return kt(n,function(n,i,u){return t(n,i,u)&&(r=n,o)}),r}function nu(n,t,i){var r=-1,e=n?n.length:0,u=Array("number"==typeof e?e:0),t=s(t,i);if(it(n))for(;++r<e;)u[r]=t(n[r],r,n);else f(n,function(n,i,f){u[++r]=t(n,i,f)});return u}function iu(n,t,i){var u=-Infinity,e=-1,o=n?n.length:0,r=u;if(t||"number"!=typeof o)t=s(t,i),f(n,function(n,i,f){i=t(n,i,f),i>u&&(u=i,r=n)});else for(;++e<o;)n[e]>r&&(r=n[e]);return r}function ci(n,t){var i=[];return f(n,function(n){i.push(n[t])}),i}function ui(n,t,i,u){var e=3>arguments.length,t=s(t,u);return f(n,function(n,u,f){i=e?(e=r,n):t(i,n,u,f)}),i}function fu(n,t,i,u){var h=n,s=n?n.length:0,c=3>arguments.length,o;return"number"!=typeof s?(o=ni(n),s=o.length):or&&e.call(n)==p&&(h=n.split("")),f(n,function(n,f,e){f=o?o[--s]:--s,i=c?(c=r,h[f]):t.call(u,i,h[f],f,e)}),i}function kt(n,t,i){var r,t=s(t,i);return f(n,function(n,i,u){return!(r=t(n,i,u))}),!!r}function ai(n,t,i){if(n)return t==u||i?n[0]:h.call(n,0,t)}function yr(n,t){for(var i,u=-1,f=n?n.length:0,r=[];++u<f;)i=n[u],it(i)?li.apply(r,t?i:yr(i)):r.push(i);return r}function d(n,t,i){var r=-1,u=n?n.length:0;if("number"==typeof i)r=(0>i?hi(0,u+i):i||0)-1;else if(i)return r=kr(n,t),n[r]===t?r:-1;for(;++r<u;)if(n[r]===t)return r;return-1}function wi(n,t,i){return n?h.call(n,t==u||i?1:t):[]}function kr(n,t,i,r){for(var u=0,f=n?n.length:u,i=i?s(i,r):ki,t=i(t);u<f;)r=u+f>>>1,i(n[r])<t?u=r+1:f=r;return u}function bi(n,t,i,u){var o=-1,c=n?n.length:0,h=[],f=h,u,e;for("function"==typeof t&&(u=i,i=t,t=r),i&&(f=[],i=s(i,u));++o<c;)u=n[o],e=i?i(u,o,n):u,(t?!o||f[f.length-1]!==e:0>d(f,e))&&(i&&f.push(e),h.push(u));return h}function wr(n,t){return ou||g&&2<arguments.length?g.call.apply(g,arguments):fi(n,t,h.call(arguments,2))}function ki(n){return n}function br(n){f(dt(n),function(t){var r=i[t]=n[t];i.prototype[t]=function(){var n=[this.__wrapped__];return li.apply(n,arguments),n=r.apply(i,n),this.__chain__&&(n=new i(n),n.__chain__=o),n}})}var o=!0,u=null,r=!1,pi="object"==typeof exports&&exports,yi="object"==typeof global&&global,si,tt,uu;yi.global===yi&&(n=yi);var a=[],lt={},du=0,ar={},au=30,lu=n._,vu=/[-?+=!~*%&^<>|{(\/]|\[\D|\b(?:delete|in|instanceof|new|typeof|void)\b/,pu=/&(?:amp|lt|gt|quot|#x27);/g,yu=/\b__p\+='';/g,of=/\b(__p\+=)''\+/g,ef=/(__e\(.*?\)|\b__t\))\+'';/g,sf=/\w*$/,cf=/(?:__e|__t=)\(\s*(?![\d\s"']|this\.)/g,pt=RegExp("^"+(lt.valueOf+"").replace(/[.*+?^=!:${}()|[\]\/\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),ri=/($^)/,hf=/[&<>"']/g,tf=/['\n\r\t\u2028\u2029\\]/g,ru="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),nf=Math.ceil,bt=a.concat,gr=Math.floor,nt=pt.test(nt=Object.getPrototypeOf)&&nt,c=lt.hasOwnProperty,li=a.push,tu=lt.propertyIsEnumerable,h=a.slice,e=lt.toString,g=pt.test(g=h.bind)&&g,oi=pt.test(oi=Array.isArray)&&oi,rf=n.isFinite,ff=n.isNaN,k=pt.test(k=Object.keys)&&k,hi=Math.max,uf=Math.min,cr=Math.random,yt="[object Arguments]",ut="[object Array]",at="[object Boolean]",wt="[object Date]",et="[object Number]",ft="[object Object]",st="[object RegExp]",p="[object String]",vi,sr,vt=(vt={0:1,length:1},a.splice.call(vt,0,1),vt[0]),nr=o;(function(){function i(){this.x=1}var t=[],n;i.prototype={valueOf:1,y:1};for(n in new i)t.push(n);for(n in arguments)nr=!n;vi=!/valueOf/.test(t),sr="x"!=t[0]})(1);var ht=!y(arguments),cu="x"!=h.call("x")[0],or="xx"!="x"[0]+Object("x")[0];try{si=e.call(n.document||0)==ft}catch(lf){}var ou=g&&/\n|Opera/.test(g+e.call(n.opera)),eu=k&&/^.+$|true/.test(k+!!n.attachEvent),v={};v[yt]=v["[object Function]"]=r,v[ut]=v[at]=v[wt]=v[et]=v[ft]=v[st]=v[p]=o,tt={boolean:r,"function":o,object:o,number:r,string:r,undefined:r},uu={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},i.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,variable:""};var ii={a:"d,c,u",k:"c=e(c,u)",b:"if(c(w,h,d)===false)return r",g:"if(c(w,h,d)===false)return r"},ti={l:r,a:"m",k:"for(var a=1,b=arguments.length;a<b;a++){if(j=arguments[a]){",g:"r[h]=w",c:"}}"},vr={b:u};ht&&(y=function(n){return n?c.call(n,"callee"):r});var b=rt(ii,vr,{l:r}),w=rt(ii,vr),lr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},su=hr(lr),hu=rt(ti,{g:"if(r[h]==null)"+ti.g}),pr=rt(ti),it=oi||function(n){return e.call(n)==ut};l(/x/)&&(l=function(n){return"[object Function]"==e.call(n)});var ct=nt?function(n){if(!n||"object"!=typeof n)return r;var i=n.valueOf,t="function"==typeof i&&(t=nt(i))&&nt(t);return t?n==t||nt(n)==t&&!y(n):ur(n)}:ur,ni=k?function(n){var t=typeof n;return"function"==t&&tu.call(n,"prototype")?tr(n):n&&tt[t]?k(n):[]}:tr,f=rt(ii);i.VERSION="0.9.1",i.after=function(n,t){return 1>n?t():function(){if(1>--n)return t.apply(this,arguments)}},i.bind=wr,i.bindAll=function(n){for(var i,t=arguments,r=1<t.length?0:(t=dt(n),-1),u=t.length;++r<u;)i=t[r],n[i]=wr(n[i],n);return n},i.chain=function(n){return n=new i(n),n.__chain__=o,n},i.clone=gi,i.compact=function(n){for(var t,r=-1,u=n?n.length:0,i=[];++r<u;)t=n[r],t&&i.push(t);return i},i.compose=function(){var n=arguments;return function(){for(var t=arguments,i=n.length;i--;)t=[n[i].apply(this,t)];return t[0]}},i.contains=ir,i.countBy=function(n,t,i){var r={},t=s(t,i);return f(n,function(n,i,u){i=t(n,i,u),c.call(r,i)?r[i]++:r[i]=1}),r},i.debounce=function(n,t,i){function s(){r=u,i||(e=n.apply(f,o))}var o,e,f,r;return function(){var u=i&&!r;return o=arguments,f=this,clearTimeout(r),r=setTimeout(s,t),u&&(e=n.apply(f,o)),e}},i.defaults=hu,i.defer=function(n){var i=h.call(arguments,1);return setTimeout(function(){n.apply(t,i)},1)},i.delay=function(n,i){var r=h.call(arguments,2);return setTimeout(function(){n.apply(t,r)},i)},i.difference=function(n){for(var t,u=-1,r=n?n.length:0,f=bt.apply(a,arguments),f=ei(f,r),i=[];++u<r;)t=n[u],f(t)||i.push(t);return i},i.escape=function(n){return n==u?"":(n+"").replace(hf,ku)},i.every=rr,i.extend=pr,i.filter=gt,i.find=di,i.first=ai,i.flatten=yr,i.forEach=f,i.forIn=b,i.forOwn=w,i.functions=dt,i.groupBy=function(n,t,i){var r={},t=s(t,i);return f(n,function(n,i,u){i=t(n,i,u),(c.call(r,i)?r[i]:r[i]=[]).push(n)}),r},i.has=function(n,t){return n?c.call(n,t):r},i.identity=ki,i.indexOf=d,i.initial=function(n,t,i){return n?h.call(n,0,-(t==u||i?1:t)):[]},i.intersection=function(n){var r=arguments,u=r.length,i={},t=[];return f(n,function(n){if(0>d(t,n)){for(var f=u;--f;)if(!(i[f]||(i[f]=ei(r[f])))(n))return;t.push(n)}}),t},i.invert=hr,i.invoke=function(n,t){var r=h.call(arguments,2),u="function"==typeof t,i=[];return f(n,function(n){i.push((u?t:n[t]).apply(n,r))}),i},i.isArguments=y,i.isArray=it,i.isBoolean=function(n){return n===o||n===r||e.call(n)==at},i.isDate=function(n){return e.call(n)==wt},i.isElement=function(n){return n?1===n.nodeType:r},i.isEmpty=function(n){var u=o,t,i;return n?(t=e.call(n),i=n.length,t==ut||t==p||t==yt||ht&&y(n)||t==ft&&"number"==typeof i&&l(n.splice)?!i:(w(n,function(){return u=r}),u)):u},i.isEqual=ot,i.isFinite=function(n){return rf(n)&&!ff(parseFloat(n))},i.isFunction=l,i.isNaN=function(n){return e.call(n)==et&&n!=+n},i.isNull=function(n){return n===u},i.isNumber=function(n){return e.call(n)==et},i.isObject=function(n){return n?tt[typeof n]:r},i.isPlainObject=ct,i.isRegExp=function(n){return e.call(n)==st},i.isString=function(n){return e.call(n)==p},i.isUndefined=function(n){return n===t},i.keys=ni,i.last=function(n,t,i){if(n){var r=n.length;return t==u||i?n[r-1]:h.call(n,-t||r)}},i.lastIndexOf=function(n,t,i){var r=n?n.length:0;for("number"==typeof i&&(r=(0>i?hi(0,r+i):uf(i,r-1))+1);r--;)if(n[r]===t)return r;return-1},i.lateBind=function(n,t){return fi(t,n,h.call(arguments,2))},i.map=nu,i.max=iu,i.memoize=function(n,t){var i={};return function(){var r=t?t.apply(this,arguments):arguments[0];return c.call(i,r)?i[r]:i[r]=n.apply(this,arguments)}},i.merge=er,i.min=function(n,t,i){var u=Infinity,e=-1,o=n?n.length:0,r=u;if(t||"number"!=typeof o)t=s(t,i),f(n,function(n,i,f){i=t(n,i,f),i<u&&(u=i,r=n)});else for(;++e<o;)n[e]<r&&(r=n[e]);return r},i.mixin=br,i.noConflict=function(){return n._=lu,this},i.object=function(n,t){for(var i,r=-1,f=n?n.length:0,u={};++r<f;)i=n[r],t?u[i]=t[r]:u[i[0]]=i[1];return u},i.omit=function(n,t,i){var f="function"==typeof t,u={},r;return f?t=s(t,i):r=bt.apply(a,arguments),b(n,function(n,i,e){(f?!t(n,i,e):0>d(r,i,1))&&(u[i]=n)}),u},i.once=function(n){var t,i=r;return function(){return i?t:(i=o,t=n.apply(this,arguments),n=u,t)}},i.pairs=function(n){var t=[];return w(n,function(n,i){t.push([i,n])}),t},i.partial=function(n){return fi(n,h.call(arguments,1))},i.pick=function(n,t,i){var u={},r;if("function"!=typeof t)for(var f=0,e=bt.apply(a,arguments),o=e.length;++f<o;)r=e[f],r in n&&(u[r]=n[r]);else t=s(t,i),b(n,function(n,i,r){t(n,i,r)&&(u[i]=n)});return u},i.pluck=ci,i.random=function(n,t){return n==u&&t==u&&(t=1),n=+n||0,t==u&&(t=n,n=0),n+gr(cr()*((+t||0)-n+1))},i.range=function(n,t,i){n=+n||0,i=+i||1,t==u&&(t=n,n=0);for(var f=-1,t=hi(0,nf((t-n)/i)),r=Array(t);++f<t;)r[f]=n,n+=i;return r},i.reduce=ui,i.reduceRight=fu,i.reject=function(n,t,i){return t=s(t,i),gt(n,function(n,i,r){return!t(n,i,r)})},i.rest=wi,i.result=function(n,t){var i=n?n[t]:u;return l(i)?n[t]():i},i.shuffle=function(n){var i=-1,t=Array(n?n.length:0);return f(n,function(n){var r=gr(cr()*(++i+1));t[i]=t[r],t[r]=n}),t},i.size=function(n){var t=n?n.length:0;return"number"==typeof t?t:ni(n).length},i.some=kt,i.sortBy=function(n,t,i){var r=[],t=s(t,i);for(f(n,function(n,i,u){r.push({a:t(n,i,u),b:i,c:n})}),n=r.length,r.sort(bu);n--;)r[n]=r[n].c;return r},i.sortedIndex=kr,i.tap=function(n,t){return t(n),n},i.template=function(n,t,r){n||(n=""),r||(r={});var e,o,c=0,s=i.templateSettings,u="__p += '",f=r.variable||s.variable,h=f;n.replace(RegExp((r.escape||s.escape||ri).source+"|"+(r.interpolate||s.interpolate||ri).source+"|"+(r.evaluate||s.evaluate||ri).source+"|$","g"),function(t,i,r,f,o){u+=n.slice(c,o).replace(tf,wu),u+=i?"'+__e("+i+")+'":f?"';"+f+";__p+='":r?"'+((__t=("+r+"))==null?'':__t)+'":"",e||(e=f||vu.test(i||r)),c=o+t.length}),u+="';",h||(f="obj",e?u="with("+f+"){"+u+"}":(r=RegExp("(\\(\\s*)"+f+"\\."+f+"\\b","g"),u=u.replace(cf,"$&"+f+".").replace(r,"$1__d"))),u=(e?u.replace(yu,""):u).replace(of,"$1").replace(ef,"$1;"),u="function("+f+"){"+(h?"":f+"||("+f+"={});")+"var __t,__p='',__e=_.escape"+(e?",__j=[].join;function print(){__p+=__j.call(arguments,'')}":(h?"":",__d="+f+"."+f+"||"+f)+";")+u+"return __p}";try{o=Function("_","return "+u)(i)}catch(l){throw l.source=u,l;}return t?o(t):(o.source=u,o)},i.throttle=function(n,t){function s(){f=new Date,i=u,o=n.apply(r,e)}var e,o,r,i,f=0;return function(){var h=new Date,u=t-(h-f);return e=arguments,r=this,0>=u?(clearTimeout(i),f=h,o=n.apply(r,e)):i||(i=setTimeout(s,u)),o}},i.times=function(n,t,i){for(var n=+n||0,r=-1,u=Array(n);++r<n;)u[r]=t.call(i,r);return u},i.toArray=function(n){return n&&"number"==typeof n.length?(cu?e.call(n)==p:"string"==typeof n)?n.split(""):h.call(n):fr(n)},i.unescape=function(n){return n==u?"":(n+"").replace(pu,gu)},i.union=function(){return bi(bt.apply(a,arguments))},i.uniq=bi,i.uniqueId=function(n){var t=du++;return n?n+t:t},i.values=fr,i.where=function(n,t){var i=[];return b(t,function(n,t){i.push(t)}),gt(n,function(n){for(var u,r=i.length;r--;)if(u=n[i[r]]===t[i[r]],!u)break;return!!u})},i.without=function(n){for(var t,r=-1,u=n?n.length:0,f=ei(arguments,1,20),i=[];++r<u;)t=n[r],f(t)||i.push(t);return i},i.wrap=function(n,t){return function(){var i=[n];return li.apply(i,arguments),t.apply(this,i)}},i.zip=function(n){for(var t=-1,r=n?iu(ci(arguments,"length")):0,i=Array(r);++t<r;)i[t]=ci(arguments,t);return i},i.all=rr,i.any=kt,i.collect=nu,i.detect=di,i.drop=wi,i.each=f,i.foldl=ui,i.foldr=fu,i.head=ai,i.include=ir,i.inject=ui,i.methods=dt,i.select=gt,i.tail=wi,i.take=ai,i.unique=bi,br(i),i.prototype.chain=function(){return this.__chain__=o,this},i.prototype.value=function(){return this.__wrapped__},f("pop push reverse shift sort splice unshift".split(" "),function(n){var t=a[n];i.prototype[n]=function(){var n=this.__wrapped__;return t.apply(n,arguments),vt&&n.length===0&&delete n[0],this.__chain__&&(n=new i(n),n.__chain__=o),n}}),f(["concat","join","slice"],function(n){var t=a[n];i.prototype[n]=function(){var n=t.apply(this.__wrapped__,arguments);return this.__chain__&&(n=new i(n),n.__chain__=o),n}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(n._=i,define(function(){return i})):pi?"object"==typeof module&&module&&module.exports==pi?(module.exports=i)._=i:pi._=i:n._=i}(this),function(n,t){(function(i){typeof define=="function"&&define.amd?define(["jquery"],i):n.sammy=t.Sammy=i(n)})(function(n){var i,w="([^/]+)",h=/:([\w\d]+)/g,v=/\?([^#]*)?$/,u=function(n){return Array.prototype.slice.call(n)},r=function(n){return Object.prototype.toString.call(n)==="[object Function]"},f=function(n){return Object.prototype.toString.call(n)==="[object Array]"},y=function(n){return Object.prototype.toString.call(n)==="[object RegExp]"},o=function(n){return decodeURIComponent((n||"").replace(/\+/g," "))},p=encodeURIComponent,a=function(n){return String(n).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e=function(n){return function(t,i){return this.route.apply(this,[n,t,i])}},c={},s=!!t.history&&!!history.pushState,l=[];return i=function(){var f=u(arguments),t,e;return(i.apps=i.apps||{},f.length===0||f[0]&&r(f[0]))?i.apply(i,["body"].concat(f)):typeof(e=f.shift())=="string"?(t=i.apps[e]||new i.Application,t.element_selector=e,f.length>0&&n.each(f,function(n,i){t.use(i)}),t.element_selector!=e&&delete i.apps[e],i.apps[t.element_selector]=t,t):void 0},i.VERSION="0.7.2",i.addLogger=function(n){l.push(n)},i.log=function(){var t=u(arguments);t.unshift("["+Date()+"]"),n.each(l,function(n,r){r.apply(i,t)})},typeof t.console!="undefined"?r(t.console.log.apply)?i.addLogger(function(){t.console.log.apply(t.console,arguments)}):i.addLogger(function(){t.console.log(arguments)}):typeof console!="undefined"&&i.addLogger(function(){console.log.apply(console,arguments)}),n.extend(i,{makeArray:u,isFunction:r,isArray:f}),i.Object=function(t){return n.extend(this,t||{})},n.extend(i.Object.prototype,{escapeHTML:a,h:a,toHash:function(){var t={};return n.each(this,function(n,i){r(i)||(t[n]=i)}),t},toHTML:function(){var t="";return n.each(this,function(n,i){r(i)||(t+="<strong>"+n+"</strong> "+i+"<br />")}),t},keys:function(n){var i=[],t;for(t in this)(!r(this[t])||!n)&&i.push(t);return i},has:function(t){return this[t]&&n.trim(this[t].toString())!==""},join:function(){var n=u(arguments),t=n.shift();return n.join(t)},log:function(){i.log.apply(i,arguments)},toString:function(t){var i=[];return n.each(this,function(n,u){(!r(u)||t)&&i.push('"'+n+'": '+u.toString())}),"Sammy.Object: {"+i.join(",")+"}"}}),i.DefaultLocationProxy=function(n,t){this.app=n,this.is_native=!1,this.has_history=s,this._startPolling(t)},i.DefaultLocationProxy.fullPath=function(n){var t=n.toString().match(/^[^#]*(#.+)$/),i=t?t[1]:"";return[n.pathname,n.search,i].join("")},n.extend(i.DefaultLocationProxy.prototype,{bind:function(){var f=this,u=this.app,r=i.DefaultLocationProxy;n(t).bind("hashchange."+this.app.eventNamespace(),function(n,i){f.is_native===!1&&!i&&(f.is_native=!0,t.clearInterval(r._interval)),u.trigger("location-changed")}),s&&!u.disable_push_state&&(n(t).bind("popstate."+this.app.eventNamespace(),function(){u.trigger("location-changed")}),n("a").live("click.history-"+this.app.eventNamespace(),function(n){if(!n.isDefaultPrevented()&&!n.metaKey&&!n.ctrlKey){var i=r.fullPath(this);if(this.hostname==t.location.hostname&&u.lookupRoute("get",i)&&this.target!=="_blank")return n.preventDefault(),f.setLocation(i),!1}})),r._bindings||(r._bindings=0),r._bindings++},unbind:function(){n(t).unbind("hashchange."+this.app.eventNamespace()),n(t).unbind("popstate."+this.app.eventNamespace()),n("a").die("click.history-"+this.app.eventNamespace()),i.DefaultLocationProxy._bindings--,i.DefaultLocationProxy._bindings<=0&&t.clearInterval(i.DefaultLocationProxy._interval)},getLocation:function(){return i.DefaultLocationProxy.fullPath(t.location)},setLocation:function(n){if(/^([^#\/]|$)/.test(n)&&(n=s&&!this.app.disable_push_state?"/"+n:"#!/"+n),n!=this.getLocation()){if(!(s&&!this.app.disable_push_state&&/^\//.test(n)))return t.location=n;history.pushState({path:n},t.title,n),this.app.trigger("location-changed")}},_startPolling:function(r){var f=this,u;i.DefaultLocationProxy._interval||(r||(r=10),u=function(){var r=f.getLocation();(typeof i.DefaultLocationProxy._last_location=="undefined"||r!=i.DefaultLocationProxy._last_location)&&t.setTimeout(function(){n(t).trigger("hashchange",[!0])},0),i.DefaultLocationProxy._last_location=r},u(),i.DefaultLocationProxy._interval=t.setInterval(u,r))}}),i.Application=function(n){var t=this;this.routes={},this.listeners=new i.Object({}),this.arounds=[],this.befores=[],this.namespace=+new Date+"-"+parseInt(Math.random()*1e3,10),this.context_prototype=function(){i.EventContext.apply(this,arguments)},this.context_prototype.prototype=new i.EventContext,r(n)&&n.apply(this,[this]),this._location_proxy||this.setLocationProxy(new i.DefaultLocationProxy(this,this.run_interval_every)),this.debug&&this.bindToAllEvents(function(n,i){t.log(t.toString(),n.cleaned_type,i||{})})},i.Application.prototype=n.extend({},i.Object.prototype,{ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error","check-form-submission","redirect","location-changed"],_last_route:null,_location_proxy:null,_running:!1,element_selector:"body",debug:!1,raise_errors:!1,run_interval_every:50,disable_push_state:!1,template_engine:null,toString:function(){return"Sammy.Application:"+this.element_selector},$element:function(t){return t?n(this.element_selector).find(t):n(this.element_selector)},use:function(){var f=u(arguments),n=f.shift(),t=n||"";try{f.unshift(this),typeof n=="string"&&(t="Sammy."+n,n=i[n]),n.apply(this,f)}catch(e){typeof n=="undefined"?this.error("Plugin Error: called use() but plugin ("+t.toString()+") is not defined",e):r(n)?this.error("Plugin Error",e):this.error("Plugin Error: called use() but '"+t.toString()+"' is not a function",e)}return this},setLocationProxy:function(n){var t=this._location_proxy;this._location_proxy=n,this.isRunning()&&(t&&t.unbind(),this._location_proxy.bind())},log:function(){i.log.apply(i,Array.prototype.concat.apply([this.element_selector],arguments))},route:function(t,i,u){var f=this,s=[],e,o;if(!u&&r(i)&&(i=t,u=i,t="any"),t=t.toLowerCase(),i.constructor==String){for(h.lastIndex=0;(o=h.exec(i))!==null;)s.push(o[1]);i=new RegExp(i.replace(h,w)+"$")}return typeof u=="string"&&(u=f[u]),e=function(n){var t={verb:n,path:i,callback:u,param_names:s};f.routes[n]=f.routes[n]||[],f.routes[n].push(t)},t==="any"?n.each(this.ROUTE_VERBS,function(n,t){e(t)}):e(t),this},get:e("get"),post:e("post"),put:e("put"),del:e("delete"),any:e("any"),mapRoutes:function(t){var i=this;return n.each(t,function(n,t){i.route.apply(i,t)}),this},eventNamespace:function(){return["sammy-app",this.namespace].join("-")},bind:function(n,t,i){var u=this,r;return typeof i=="undefined"&&(i=t),r=function(){var t,r,n;t=arguments[0],n=arguments[1],n&&n.context?(r=n.context,delete n.context):r=new u.context_prototype(u,"bind",t.type,n,t.target),t.cleaned_type=t.type.replace(u.eventNamespace(),""),i.apply(r,[t,n])},this.listeners[n]||(this.listeners[n]=[]),this.listeners[n].push(r),this.isRunning()&&this._listen(n,r),this},trigger:function(n,t){return this.$element().trigger([n,this.eventNamespace()].join("."),[t]),this},refresh:function(){return this.last_location=null,this.trigger("location-changed"),this},before:function(n,t){return r(n)&&(t=n,n={}),this.befores.push([n,t]),this},after:function(n){return this.bind("event-context-after",n)},around:function(n){return this.arounds.push(n),this},isRunning:function(){return this._running},helpers:function(t){return n.extend(this.context_prototype.prototype,t),this},helper:function(n,t){return this.context_prototype.prototype[n]=t,this},run:function(i){if(this.isRunning())return!1;var r=this;return n.each(this.listeners.toHash(),function(t,i){n.each(i,function(n,i){r._listen(t,i)})}),this.trigger("run",{start_url:i}),this._running=!0,this.last_location=null,!/\#(.+)/.test(this.getLocation())&&typeof i!="undefined"&&this.setLocation(i),this._checkLocation(),this._location_proxy.bind(),this.bind("location-changed",function(){r._checkLocation()}),this.bind("submit",function(t){var i=r._checkFormSubmission(n(t.target).closest("form"));return i===!1?t.preventDefault():!1}),n(t).bind("unload",function(){r.unload()}),this.trigger("changed")},unload:function(){if(!this.isRunning())return!1;var t=this;return this.trigger("unload"),this._location_proxy.unbind(),this.$element().unbind("submit").removeClass(t.eventNamespace()),n.each(this.listeners.toHash(),function(i,r){n.each(r,function(n,r){t._unlisten(i,r)})}),this._running=!1,this},destroy:function(){return this.unload(),delete i.apps[this.element_selector],this},bindToAllEvents:function(t){var i=this;return n.each(this.APP_EVENTS,function(n,r){i.bind(r,t)}),n.each(this.listeners.keys(!0),function(r,u){n.inArray(u,i.APP_EVENTS)==-1&&i.bind(u,t)}),this},routablePath:function(n){return n.replace(v,"")},lookupRoute:function(n,t){var e=this,u=!1,i=0,f,r;if(typeof this.routes[n]!="undefined")for(f=this.routes[n].length;i<f;i++)if(r=this.routes[n][i],e.routablePath(t).match(r.path)){u=r;break}return u},runRoute:function(t,i,r,u){var p=this,e=this.lookupRoute(t,i),f,s,y,b,c,l,a,h,v;if(this.log("runRoute",[t,i].join(" ")),this.trigger("run-route",{verb:t,path:i,params:r}),typeof r=="undefined"&&(r={}),n.extend(r,this._parseQueryString(i)),e){this.trigger("route-found",{route:e}),(h=e.path.exec(this.routablePath(i)))!==null&&(h.shift(),n.each(h,function(n,t){e.param_names[n]?r[e.param_names[n]]=o(t):(r.splat||(r.splat=[]),r.splat.push(o(t)))})),f=new this.context_prototype(this,t,i,r,u),y=this.arounds.slice(0),c=this.befores.slice(0),a=[f].concat(r.splat),s=function(){for(var n;c.length>0;)if(l=c.shift(),p.contextMatchesOptions(f,l[0])&&(n=l[1].apply(f,[f]),n===!1))return!1;return p.last_route=e,f.trigger("event-context-before",{context:f}),n=e.callback.apply(f,a),f.trigger("event-context-after",{context:f}),n},n.each(y.reverse(),function(n,t){var i=s;s=function(){return t.apply(f,[i])}});try{v=s()}catch(w){this.error(["500 Error",t,i].join(" "),w)}return v}return this.notFound(t,i)},contextMatchesOptions:function(t,i,r){var u=i,c,s,a,l,h,o,e;if((typeof u=="string"||y(u))&&(u={path:u}),typeof r=="undefined"&&(r=!0),n.isEmptyObject(u))return!0;if(f(u.path)){for(c=[],s=0,l=u.path.length;s<l;s+=1)a=n.extend({},u,{path:u.path[s]}),c.push(this.contextMatchesOptions(t,a));return h=n.inArray(!0,c)>-1?!0:!1,r?h:!h}return u.only?this.contextMatchesOptions(t,u.only,!0):u.except?this.contextMatchesOptions(t,u.except,!1):(o=!0,e=!0,u.path&&(y(u.path)||(u.path=new RegExp(u.path.toString()+"$")),o=u.path.test(t.path)),u.verb&&(e=typeof u.verb=="string"?u.verb===t.verb:u.verb.indexOf(t.verb)>-1),r?e&&o:!e||!o)},getLocation:function(){return this._location_proxy.getLocation()},setLocation:function(n){return this._location_proxy.setLocation(n)},swap:function(n,t){var i=this.$element().html(n);return r(t)&&t(n),i},templateCache:function(n,t){return typeof t!="undefined"?c[n]=t:c[n]},clearTemplateCache:function(){return c={}},notFound:function(n,t){var i=this.error(["404 Not Found",n,t].join(" "));return n==="get"?i:!0},error:function(n,t){if(t||(t=new Error),t.message=[n,t.message].join(" "),this.trigger("error",{message:t.message,error:t}),this.raise_errors)throw t;this.log(t.message,t)},_checkLocation:function(){var n,t;return n=this.getLocation(),this.last_location&&this.last_location[0]=="get"&&this.last_location[1]==n||(this.last_location=["get",n],t=this.runRoute("get",n)),t},_getFormVerb:function(t){var u=n(t),i,r;return r=u.find('input[name="_method"]'),r.length>0&&(i=r.val()),i||(i=u[0].getAttribute("method")),i&&i!==""||(i="get"),n.trim(i.toString().toLowerCase())},_checkFormSubmission:function(t){var i,u,e,r,f;return this.trigger("check-form-submission",{form:t}),i=n(t),u=i.attr("action")||"",e=this._getFormVerb(i),this.log("_checkFormSubmission",i,u,e),e==="get"?(r=this._serializeFormParams(i),r!==""&&(u+="?"+r),this.setLocation(u),f=!1):(r=n.extend({},this._parseFormParams(i)),f=this.runRoute(e,u,r,t.get(0))),typeof f=="undefined"?!1:f},_serializeFormParams:function(n){var r="",t=n.serializeArray(),i;if(t.length>0)for(r=this._encodeFormPair(t[0].name,t[0].value),i=1;i<t.length;i++)r=r+"&"+this._encodeFormPair(t[i].name,t[i].value);return r},_encodeFormPair:function(n,t){return p(n)+"="+p(t)},_parseFormParams:function(n){for(var i={},r=n.serializeArray(),t=0;t<r.length;t++)i=this._parseParamPair(i,r[t].name,r[t].value);return i},_parseQueryString:function(n){var r={},i,f,u,t;if(i=n.match(v),i&&i[1])for(f=i[1].split("&"),t=0;t<f.length;t++)u=f[t].split("="),r=this._parseParamPair(r,o(u[0]),o(u[1]||""));return r},_parseParamPair:function(n,t,i){return typeof n[t]!="undefined"?f(n[t])?n[t].push(i):n[t]=[n[t],i]:n[t]=i,n},_listen:function(n,t){return this.$element().bind([n,this.eventNamespace()].join("."),t)},_unlisten:function(n,t){return this.$element().unbind([n,this.eventNamespace()].join("."),t)}}),i.RenderContext=function(n){this.event_context=n,this.callbacks=[],this.previous_content=null,this.content=null,this.next_engine=!1,this.waiting=!1},i.RenderContext.prototype=n.extend({},i.Object.prototype,{then:function(n){var u,i;if(!r(n)){if(!(typeof n=="string"&&n in this.event_context))return this;u=this.event_context[n],n=function(n){return u.apply(this.event_context,[n])}}return i=this,this.waiting?this.callbacks.push(n):(this.wait(),t.setTimeout(function(){var t=n.apply(i,[i.content,i.previous_content]);t!==!1&&i.next(t)},0)),this},wait:function(){this.waiting=!0},next:function(n){this.waiting=!1,typeof n!="undefined"&&(this.previous_content=this.content,this.content=n),this.callbacks.length>0&&this.then(this.callbacks.shift())},load:function(t,i,u){var f=this;return this.then(function(){var o,s,e,h;return(r(i)?(u=i,i={}):i=n.extend({},i),u&&this.then(u),typeof t=="string")?(e=t.match(/\.json$/)||i.json,o=e?i.cache===!0:i.cache!==!1,f.next_engine=f.event_context.engineFor(t),delete i.cache,delete i.json,i.engine&&(f.next_engine=i.engine,delete i.engine),o&&(s=this.event_context.app.templateCache(t))?s:(this.wait(),n.ajax(n.extend({url:t,data:{},dataType:e?"json":"text",type:"get",success:function(n){o&&f.event_context.app.templateCache(t,n),f.next(n)}},i)),!1)):t.nodeType?t.innerHTML:t.selector?(f.next_engine=t.attr("data-engine"),i.clone===!1?t.remove()[0].innerHTML.toString():t[0].innerHTML.toString()):void 0})},loadPartials:function(n){var t;if(n){this.partials=this.partials||{};for(t in n)(function(t,i){t.load(n[i]).then(function(n){this.partials[i]=n})})(this,t)}return this},render:function(n,t,i,u){return r(n)&&!t?this.then(n):(r(t)?(u=i,i=t,t=null):i&&!r(i)&&(u=i,i=null),this.loadPartials(u).load(n).interpolate(t,n).then(i))},partial:function(n,t,i,u){return r(i)?this.render(n,t,u).swap(i):r(t)?this.render(n,{},i).swap(t):this.render(n,t,i).swap()},send:function(){var i=this,n=u(arguments),t=n.shift();return f(n[0])&&(n=n[0]),this.then(function(){return n.push(function(n){i.next(n)}),i.wait(),t.apply(t,n),!1})},collect:function(t,i,u){var e=this,f=function(){r(t)&&(i=t,t=this.content);var u=[],f=!1;return n.each(t,function(n,t){var r=i.apply(e,[n,t]);return r.jquery&&r.length==1&&(r=r[0],f=!0),u.push(r),r}),f?u:u.join("")};return u?f():this.then(f)},renderEach:function(t,i,r,u){return f(i)&&(u=r,r=i,i=null),this.load(t).then(function(e){var o=this;if(r||(r=f(this.previous_content)?this.previous_content:[]),!u)return this.collect(r,function(n,r){var u={},f=this.next_engine||t;return i?u[i]=r:u=r,this.event_context.interpolate(e,u,f)},!0);n.each(r,function(n,r){var f={},s=this.next_engine||t;i?f[i]=r:f=r,u(r,o.event_context.interpolate(e,f,s))})})},interpolate:function(n,t,i){var r=this;return this.then(function(u,f){!n&&f&&(n=f),this.next_engine&&(t=this.next_engine,this.next_engine=!1);var e=r.event_context.interpolate(u,n,t,this.partials);return i?f+e:e})},swap:function(n){return this.then(function(t){return this.event_context.swap(t,n),t}).trigger("changed",{})},appendTo:function(t){return this.then(function(i){n(t).append(i)}).trigger("changed",{})},prependTo:function(t){return this.then(function(i){n(t).prepend(i)}).trigger("changed",{})},replace:function(t){return this.then(function(i){n(t).html(i)}).trigger("changed",{})},trigger:function(n,t){return this.then(function(i){return typeof t=="undefined"&&(t={content:i}),this.event_context.trigger(n,t),i})}}),i.EventContext=function(n,t,r,u,f){this.app=n,this.verb=t,this.path=r,this.params=new i.Object(u),this.target=f},i.EventContext.prototype=n.extend({},i.Object.prototype,{$element:function(){return this.app.$element(u(arguments).shift())},engineFor:function(n){var t=this,i;return r(n)?n:(n=(n||t.app.template_engine).toString(),(i=n.match(/\.([^\.\?\#]+)$/))&&(n=i[1]),n&&r(t[n])?t[n]:t.app.template_engine?this.engineFor(t.app.template_engine):function(n){return n})},interpolate:function(n,t,i,r){return this.engineFor(i).apply(this,[n,t,r])},render:function(n,t,r,u){return new i.RenderContext(this).render(n,t,r,u)},renderEach:function(n,t,r,u){return new i.RenderContext(this).renderEach(n,t,r,u)},load:function(n,t,r){return new i.RenderContext(this).load(n,t,r)},loadPartials:function(n){return new i.RenderContext(this).loadPartials(n)},partial:function(n,t,r,u){return new i.RenderContext(this).partial(n,t,r,u)},send:function(){var n=new i.RenderContext(this);return n.send.apply(n,arguments)},redirect:function(){var t,r=u(arguments),l=this.app.getLocation(),h=r.length,e;if(h>1){for(var i=0,c=[],s=[],f={},o=!1;i<h;i++)typeof r[i]=="string"?c.push(r[i]):(n.extend(f,r[i]),o=!0);if(t=c.join("/"),o){for(e in f)s.push(this.app._encodeFormPair(e,f[e]));t+="?"+s.join("&")}}else t=r[0];this.trigger("redirect",{to:t}),this.app.last_location=[this.verb,this.path],this.app.setLocation(t),new RegExp(t).test(l)&&this.app.trigger("location-changed")},trigger:function(n,t){return typeof t=="undefined"&&(t={}),t.context||(t.context=this),this.app.trigger(n,t)},eventNamespace:function(){return this.app.eventNamespace()},swap:function(n,t){return this.app.swap(n,t)},notFound:function(){return this.app.notFound(this.verb,this.path)},json:function(t){return n.parseJSON(t)},toString:function(){return"Sammy.EventContext: "+[this.verb,this.path,this.params].join(" ")}}),i})}(jQuery,window)